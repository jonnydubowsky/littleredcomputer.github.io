!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.s=t()}}(function(){return function t(e,n,a){function r(i,s){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!s&&c)return c(i,!0);if(o)return o(i,!0);var u=new Error("Cannot find module '"+i+"'");throw u.code="MODULE_NOT_FOUND",u}var f=n[i]={exports:{}};e[i][0].call(f.exports,function(t){var n=e[i][1][t];return r(n?n:t)},f,f.exports,t,e,n,a)}return n[i].exports}for(var o="function"==typeof require&&require,i=0;i<a.length;i++)r(a[i]);return r}({1:[function(t,e,n){"use strict";var a;!function(t){t[t.Converged=0]="Converged",t[t.MaxStepsExceeded=1]="MaxStepsExceeded",t[t.EarlyReturn=2]="EarlyReturn"}(a=n.Outcome||(n.Outcome={}));var r=function(){function t(t){this.n=t,this.uRound=2.3e-16,this.maxSteps=1e4,this.initialStepSize=1e-4,this.maxStepSize=0,this.maxExtrapolationColumns=9,this.stepSizeSequence=0,this.stabilityCheckCount=1,this.stabilityCheckTableLines=2,this.denseOutput=!1,this.denseOutputErrorEstimator=!0,this.denseComponents=void 0,this.interpolationFormulaDegree=4,this.stepSizeReductionFactor=.5,this.stepSizeFac1=.02,this.stepSizeFac2=4,this.stepSizeFac3=.8,this.stepSizeFac4=.9,this.stepSafetyFactor1=.65,this.stepSafetyFactor2=.94,this.relativeTolerance=1e-5,this.absoluteTolerance=1e-5,this.debug=!1}return t.prototype.grid=function(t,e){var n=this.denseComponents;if(!n){n=[];for(var a=0;a<this.n;++a)n.push(a)}var r;return function(a,o,i,s,c){if(1===a)return e(i,s),void(r=i+t);for(;r<=i;){for(var u=[],f=0,h=n;f<h.length;f++){var p=h[f];u.push(c(p,r))}e(r,u),r+=t}}},t.dim2=function(e,n){for(var a=new Array(e+1),r=1;r<=e;++r)a[r]=t.dim(n);return a},t.stepSizeSequence=function(t,e){var n=new Array(e+1);switch(n[0]=0,t){case 1:for(var a=1;a<=e;++a)n[a]=2*a;break;case 2:n[1]=2;for(var a=2;a<=e;++a)n[a]=4*a-4;break;case 3:n[1]=2,n[2]=4,n[3]=6;for(var a=4;a<=e;++a)n[a]=2*n[a-2];break;case 4:for(var a=1;a<=e;++a)n[a]=4*a-2;break;case 5:for(var a=1;a<=e;++a)n[a]=4*a;break;default:throw new Error("invalid stepSizeSequence selected")}return n},t.prototype.solve=function(e,n,r,o,i){function s(t,e){var n=[0];if(Array.isArray(t))return n.concat(t);for(var a=0;a<e;++a)n.push(t);return n}var c=this,u=[0].concat(r),f=t.dim(this.n),h=t.dim(this.n),p=t.dim(this.n);if(this.maxSteps<=0)throw new Error("maxSteps must be positive");var v=this.maxExtrapolationColumns;if(v<=2)throw new Error("maxExtrapolationColumns must be > 2");var l=this.stepSizeSequence||(this.denseOutput?4:1);if(l<=3&&this.denseOutput)throw new Error("stepSizeSequence incompatible with denseOutput");if(this.denseOutput&&!i)throw new Error("denseOutput requires a solution observer function");if(this.interpolationFormulaDegree<=0||this.interpolationFormulaDegree>=7)throw new Error("bad interpolationFormulaDegree");var d=[0],m=0;if(this.denseOutput)if(this.denseComponents)for(var g=0,S=this.denseComponents;g<S.length;g++){var M=S[g];if(M<0||M>this.n)throw new Error("bad dense component: "+M);d.push(M+1),++m}else{for(var x=1;x<=this.n;++x)d.push(x);m=this.n}if(this.uRound<=1e-35||this.uRound>1)throw new Error("suspicious value of uRound");var w=Math.abs(this.maxStepSize||o-n),y=2*v*v+v,E=s(this.absoluteTolerance,this.n),b=s(this.relativeTolerance,this.n),F=[0,0,0,0],I=F[0],z=F[1],C=F[2],R=F[3],P=Math.max(1,m),O=Math.max(1,(2*v+5)*m),A=t.dim(O),L=t.dim2(y,P),q=function(t,n,a){for(var r=e(t,n.slice(1)),o=0;o<r.length;++o)a[o+1]=r[o]},B=function(){var e,r,s,m=function(t){if(N=n,n+=H,c.denseOutput){s=2*rt-c.interpolationFormulaDegree+1;for(var a=1;a<=P;++a)A[a]=u[d[a]];e=N,r=H;for(var a=1;a<=P;++a)A[P+a]=H*f[d[a]];for(var o=2*P,a=1;a<=P;++a)A[o+a]=F[1][d[a]];for(var m=2;m<=rt;++m)for(var g=O[m],w=m;w>=2;--w)for(var E=Math.pow(g/O[w-1],2)-1,a=1;a<=P;++a)x[w-1][a]=x[w][a]+(x[w][a]-x[w-1][a])/E;for(var b=4*P,a=1;a<=P;++a)A[b+a]=x[1][a];for(var a=1;a<=t;++a)h[a]=F[1][a];q(n,h,p),b=3*P;for(var a=1;a<=P;++a)A[b+a]=p[d[a]]*H;for(var I=1;I<=s;++I){for(var z=(I+1)/2|0,k=z;k<=rt;++k){var U=Math.pow(O[k]/2,I-1);K=V[k+1]-2*k+I;for(var a=1;a<=P;++a)x[k][a]=L[K][a]*U}for(var m=z+1;m<=rt;++m)for(var g=O[m],w=m;w>=z+1;--w)for(var E=Math.pow(g/O[w-1],2)-1,a=1;a<=P;++a)x[w-1][a]=x[w][a]+(x[w][a]-x[w-1][a])/E;b=(I+4)*P;for(var a=1;a<=P;++a)A[b+a]=x[z][a]*H;if(I!==s){for(var k=(I+2)/2|0;k<=rt;++k){var W=V[k+1],X=V[k]+I+1;1===I&&4===l&&(X+=2);var w=void 0;for(w=W;w>=X;w-=2)for(var a=1;a<=P;++a)L[w][a]-=L[w-2][a];if(1===I&&4===l){w=X-2;for(var a=1;a<=P;++a)L[w][a]-=f[d[a]]}}for(var k=(I+2)/2|0;k<=rt;++k)for(var W=V[k+1]-1,X=V[k]+I+2,w=W;w>=X;w-=2)for(var a=1;a<=P;++a)L[w][a]-=L[w-2][a]}}if(S(P,A,s),c.denseOutputErrorEstimator&&s>=1){for(var Y=0,a=1;a<=P;++a)Y+=Math.pow(A[(s+4)*P+a]/D[d[a]],2);if(Y=Math.sqrt(Y/P)*_[s],Z=H/Math.max(Math.pow(Y,1/(s+4)),.01),Y>10)return H=Z,n=N,++R,nt=!0,!0}for(var a=1;a<=t;++a)f[a]=p[a]}for(var a=1;a<=t;++a)u[a]=F[1][a];if(++C,i&&i(C+1,N,n,u.slice(1),c.denseOutput&&M(e,r,s,A,d))===!1)return!1;var G;return 2===rt?(G=Math.min(3,v-1),nt&&(G=2)):rt<=j?(G=rt,$[rt-1]<$[rt]*c.stepSizeFac3&&(G=rt-1),$[rt]<$[rt-1]*c.stepSizeFac4&&(G=Math.min(rt+1,v-1))):(G=rt-1,rt>3&&$[rt-2]<$[rt-1]*c.stepSizeFac3&&(G=rt-2),$[rt]<$[G]*c.stepSizeFac4&&(G=Math.min(rt,v-1))),nt?(j=Math.min(G,rt),H=T*Math.min(Math.abs(H),Math.abs(y[j])),nt=!1,!0):(H=G<=rt?y[G]:rt<j&&$[rt]<$[rt-1]*c.stepSizeFac4?y[rt]*B[G+1]/B[rt]:y[rt]*B[G]/B[rt],j=G,H=T*Math.abs(H),!0)},g=function(e){for(var a=t.dim(c.n),r=H/O[e],o=1;o<=c.n;++o)h[o]=u[o],p[o]=u[o]+r*f[o];for(var i=O[e]-1,s=O[e]/2|0,v=1;v<=i;++v){if(c.denseOutput&&v===s)for(var o=1;o<=P;++o)x[e][o]=p[d[o]];if(q(n+r*v,p,a),c.denseOutput&&Math.abs(v-s)<=2*e-1){++K;for(var o=1;o<=P;++o)L[K][o]=a[d[o]]}for(var o=1;o<=c.n;++o){var l=h[o];h[o]=p[o],p[o]=l+2*r*a[o]}if(v<=c.stabilityCheckCount&&e<=c.stabilityCheckTableLines){for(var m=0,o=1;o<=c.n;++o)m+=Math.pow(f[o]/D[o],2);for(var g=0,o=1;o<=c.n;++o)g+=Math.pow((a[o]-f[o])/D[o],2);var S=g/Math.max(c.uRound,m);if(S>4)return++I,tt=!0,H*=c.stepSizeReductionFactor,void(nt=!0)}}if(q(n+H,p,a),c.denseOutput&&s<=2*e-1){++K;for(var o=1;o<=P;++o)L[K][o]=a[d[o]]}for(var o=1;o<=c.n;++o)F[e][o]=(h[o]+p[o]+r*a[o])/2;if(I+=O[e],1!==e){for(var M,z=O[e],C=e;C>1;--C){M=Math.pow(z/O[C-1],2)-1;for(var o=1;o<=c.n;++o)F[C-1][o]=F[C][o]+(F[C][o]-F[C-1][o])/M}J=0;for(var o=1;o<=c.n;++o){var R=Math.max(Math.abs(u[o]),Math.abs(F[1][o]));D[o]=E[o]+b[o]*R,J+=Math.pow((F[1][o]-F[2][o])/D[o],2)}if(J=Math.sqrt(J/c.n),J*c.uRound>=1||e>2&&J>=Q)return tt=!0,H*=c.stepSizeReductionFactor,void(nt=!0);Q=Math.max(4*J,1);var A=1/(2*e-1),k=Math.pow(c.stepSizeFac1,A);M=Math.min(c.stepSizeFac2/k,Math.max(k,Math.pow(J/c.stepSafetyFactor1,A)/c.stepSafetyFactor2)),M=1/M,y[e]=Math.min(Math.abs(H)*M,w),$[e]=B[e]/y[e]}},S=function(t,e,n){for(var a=new Array(31),r=1;r<=t;++r){var o=e[r],i=e[2*t+r],s=e[t+r],c=e[3*t+r],u=i-o,f=-c+u,h=s-u;if(e[t+r]=u,e[2*t+r]=f,e[3*t+r]=h,!(n<0)){var p=.5*(o+i)+.125*(f+h),v=u+.25*(f-h),l=-(s-c),d=6*(h-f);if(n>=1&&(a[1]=16*(e[5*t+r]-v),n>=3&&(a[3]=16*(e[7*t+r]-d+3*a[1]),n>=5)))for(var m=5;m<=n;m+=2){var g=m*(m-1)/2,S=g*(m-2)*(m-3)*2;a[m]=16*(e[(m+4)*t+r]+g*a[m-2]-S*a[m-4])}if(a[0]=16*(e[4*t+r]-p),n>=2&&(a[2]=16*(e[6*t+r]-l+a[0]),n>=4))for(var m=4;m<=n;m+=2){var g=m*(m-1)/2,S=m*(m-1)*(m-2)*(m-3);a[m]=16*(e[t*(m+4)+r]+a[m-2]*g-a[m-4]*S)}for(var m=0;m<=n;++m)e[t*(m+4)+r]=a[m]}}},M=function(t,e,n,a,r){return function(o,i){for(var s=0,c=1;c<=P;++c)r[c]===o+1&&(s=c);if(0===s)throw new Error("no dense output available for component "+o);var u=(i-t)/e,f=1-u,h=a[s]+u*(a[P+s]+f*(a[2*P+s]*u+a[3*P+s]*f));if(n<0)return h;for(var p=u-.5,v=a[P*(n+4)+s],l=n;l>=1;--l)v=a[P*(l+3)+s]+v*p/l;return h+Math.pow(u*f,2)*v}},x=t.dim2(v,P),y=t.dim(v),F=t.dim2(v,c.n),O=t.stepSizeSequence(l,v),B=t.dim(v);B[1]=1+O[1];for(var k=2;k<=v;++k)B[k]=B[k-1]+O[k];for(var D=t.dim(c.n),k=1;k<=c.n;++k)D[k]=E[k]+b[k]+Math.abs(u[k]);var T=o-n>=0?1:-1,j=Math.max(2,Math.min(v-1,Math.floor(.6*-t.log10(b[1]+1e-40)+1.5))),H=Math.max(Math.abs(c.initialStepSize),1e-4);H=T*Math.min(H,w,Math.abs(o-n)/2);var V=t.dim(v+1),_=t.dim(2*v),N=n,K=0;if(i){if(c.denseOutput){V[1]=0;for(var k=1;k<=v;++k){var U=4*k-2;O[k]>U&&++U,V[k+1]=V[k]+U}for(var W=1;W<=2*v;++W){for(var X=.5*Math.sqrt(W/(W+4)),Y=Math.pow(1/(W+4),2),G=1;G<=W;++G)Y*=X/G;_[W]=Y}K=0}if(!1===i(C+1,N,n,u.slice(1)))return a.EarlyReturn}var J=0,Q=1e10,Z=T*w,$=t.dim(v);$[1]=0;var tt,et,nt=!1,at=!1,rt=0;!function(t){t[t.Start=0]="Start",t[t.BasicIntegrationStep=1]="BasicIntegrationStep",t[t.ConvergenceStep=2]="ConvergenceStep",t[t.HopeForConvergence=3]="HopeForConvergence",t[t.Accept=4]="Accept",t[t.Reject=5]="Reject"}(et||(et={}));var ot=et.Start;t:for(;;)switch(c.debug&&console.log("STATE",et[ot],z,N,n,H,j,rt,Z),ot){case et.Start:if(tt=!1,.1*Math.abs(o-n)<=Math.abs(n)*c.uRound)break t;if(H=T*Math.min(Math.abs(H),Math.abs(o-n),w,Math.abs(Z)),(n+1.01*H-o)*T>0&&(H=o-n,at=!0),0!==z&&c.denseOutput||(q(n,u,f),++I),0===z||at){K=0,++z;for(var G=1;G<=j;++G){if(rt=G,g(G),tt)continue t;if(G>1&&J<=1){ot=et.Accept;continue t}}ot=et.HopeForConvergence;continue}ot=et.BasicIntegrationStep;continue;case et.BasicIntegrationStep:if(K=0,++z,z>=c.maxSteps)return a.MaxStepsExceeded;rt=j-1;for(var G=1;G<=rt;++G)if(g(G),tt){ot=et.Start;continue t}ot=2===j||nt?et.ConvergenceStep:J<=1?et.Accept:J>Math.pow(O[j+1]*O[j]/4,2)?et.Reject:et.ConvergenceStep;continue;case et.ConvergenceStep:if(g(j),tt){ot=et.Start;continue}if(rt=j,J<=1){ot=et.Accept;continue}ot=et.HopeForConvergence;continue;case et.HopeForConvergence:if(J>Math.pow(O[j+1]/2,2)){ot=et.Reject;continue}rt=j+1,g(rt),ot=tt?et.Start:J>1?et.Reject:et.Accept;continue;case et.Accept:if(!m(c.n))return a.EarlyReturn;ot=et.Start;continue;case et.Reject:j=Math.min(j,rt,v-1),j>2&&$[j-1]<$[j]*c.stepSizeFac3&&(j-=1),++R,H=T*y[j],nt=!0,ot=et.BasicIntegrationStep}return a.Converged},k=B();return{y:u.slice(1),outcome:k,nStep:z,xEnd:o,nAccept:C,nReject:R,nEval:I}},t}();r.dim=function(t){return Array(t+1)},r.log10=function(t){return Math.log(t)/Math.LN10},n.Solver=r},{}],2:[function(t,e,n){"use strict";var a=t("odex/src/odex"),r=2*Math.PI,o=function(){function t(e){this.K=e,this.PV=t.principal_value(r)}return t.principal_value=function(t){var e=t-r;return function(n){if(e<=n&&n<t)return n;var a=n-r*Math.floor(n/r);return a<t?a:a-r}},t.prototype.generateSection=function(t,e,n){for(var a=t[0],r=t[1],o=0;o<e;++o){n(a,r);var i=r+this.K*Math.sin(a);a=this.PV(a+i),r=this.PV(i)}},t}();o.twoPi=2*Math.PI,n.StandardMap=o;var i=function(){function t(t){this.paramfn=t,this.S=new a.Solver(3),this.S.denseOutput=!0,this.S.absoluteTolerance=1e-8,this.PV=o.principal_value(Math.PI)}return t.prototype.HamiltonSysder=function(t,e,n,a,r){return function(o,i){var s=i[0],c=i[1],u=i[2],f=Math.pow(e,2),h=n*s,p=Math.sin(c),v=Math.cos(c);return[1,(Math.sin(h)*p*a*e*t*n+u)/(f*t),(-Math.pow(Math.sin(h),2)*v*p*Math.pow(a,2)*e*t*Math.pow(n,2)-Math.sin(h)*v*a*n*u-p*r*f*t)/e]}},t.prototype.LagrangeSysder=function(t,e,n,a){return function(r,o){var i=o[0],s=o[1],c=o[2],u=Math.sin(s);return[1,c,(u*Math.cos(e*i)*n*Math.pow(e,2)-u*a)/t]}},t.prototype.generateSection=function(t,e,n){var a=this,r=this.paramfn(),o=2*Math.PI/r.omega,i=1e3*o,s=this.HamiltonSysder(1,1,r.omega,r.a,9.8);this.S.solve(s,0,[0].concat(t),i,this.S.grid(o,function(t,e){return n(a.PV(e[1]),e[2])}))},t.prototype.evolve=function(t,e,n,a){var r=this.paramfn();console.log("params",r);var o=this.LagrangeSysder(1,r.omega,r.a,9.8),i=performance.now();this.S.solve(o,0,[0].concat(t),e,this.S.grid(n,a)),console.log("evolution took",(performance.now()-i).toFixed(2),"msec")},t}();n.DrivenPendulumMap=i;var s=function(){function t(t,e,n,a){var r=this;this.i=0,this.pt=function(t,e){r.context.beginPath(),r.context.arc(t,e,.01,0,2*Math.PI),r.context.fill(),r.context.closePath(),++r.i},this.canvas=document.getElementById(t),this.M=e,this.context=this.canvas.getContext("2d");var o=[n[1]-n[0],a[1]-a[0]],i=o[0],s=o[1];this.canvas.onmousedown=function(t){var e=[t.offsetX/r.context.canvas.width*i+n[0],a[1]-t.offsetY/r.context.canvas.height*s],o=e[0],c=e[1],u=performance.now();r.Explore(o,c),console.log("exploration",(performance.now()-u).toFixed(2),"msec"),r.onExplore&&r.onExplore(o,c)},this.context.scale(this.context.canvas.width/i,-this.context.canvas.height/s),this.context.translate(-n[0],-a[1]),this.context.fillStyle="rgba(23,64,170,0.5)"}return t.prototype.Explore=function(t,e){this.M.generateSection([t,e],1e3,this.pt)},t}();n.ExploreMap=s;var c=function(){function t(t){var e=this;this.amplitude=.1,this.animLogicalSize=1.3,this.frame=function(){var t=function(t){return e.amplitude*Math.cos(e.omega*t)};e.ctx.clearRect(-e.animLogicalSize,-e.animLogicalSize,2*e.animLogicalSize,2*e.animLogicalSize);var n=e.data[e.frameIndex],a=t(n[0]),r=n[1],o=e.ctx;if(o.lineWidth=.02,o.beginPath(),o.fillStyle="#000",o.arc(0,a,.05,0,2*Math.PI),o.fillStyle="#f00",o.arc(Math.sin(r),a-Math.cos(r),.1,0,2*Math.PI),o.fill(),o.fillStyle="#000",o.beginPath(),o.moveTo(0,a),o.lineTo(Math.sin(r),a-Math.cos(r)),o.stroke(),++e.frameIndex,e.frameIndex<e.data.length)window.requestAnimationFrame(e.frame);else{e.animating=!1;var i=(performance.now()-e.frameStart)/1e3;console.log("animation done",(e.data.length/i).toFixed(2),"fps")}};var n=document.getElementById(t.omegaRangeId),a=document.getElementById(t.tRangeId),r=new i(function(){return{a:e.amplitude,omega:+n.value}}),o=document.getElementById(t.animId);this.ctx=o.getContext("2d"),this.ctx.scale(o.width/(2*this.animLogicalSize),-o.height/(2*this.animLogicalSize)),this.ctx.translate(this.animLogicalSize,-this.animLogicalSize);var c=new s("p",r,[-Math.PI,Math.PI],[-10,10]);c.onExplore=function(n,a){console.log("onExplore",n,a),document.getElementById(t.theta0Id).textContent=n.toFixed(3),document.getElementById(t.thetaDot0Id).textContent=a.toFixed(3),e.initialData=[n,a]};var u=document.getElementById(t.exploreId);n.addEventListener("change",function(e){u.getContext("2d").clearRect(-Math.PI,-10,2*Math.PI,20);var n=e.target;document.getElementById(t.omegaValueId).textContent=(+n.value).toFixed(1)}),a.addEventListener("change",function(e){var n=e.target;document.getElementById(t.tValueId).textContent=n.value}),document.getElementById(t.goButtonId).addEventListener("click",function(){var t=1/60,o=+a.value,i=Math.ceil(o/t);e.data=new Array(i);var s=0;e.omega=+n.value;var c=performance.now();r.evolve(e.initialData,o,t,function(t,n){e.data[s++]=n}),console.log("DE evolution in",(performance.now()-c).toFixed(1),"msec"),e.frameIndex=0,e.frameStart=performance.now(),e.animating||(e.animating=!0,requestAnimationFrame(e.frame))})}return t}();n.DrivenPendulumAnimation=c},{"odex/src/odex":1}]},{},[2])(2)});