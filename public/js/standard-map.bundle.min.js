!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.s=t()}}(function(){return function t(e,r,n){function a(i,s){if(!r[i]){if(!e[i]){var c="function"==typeof require&&require;if(!s&&c)return c(i,!0);if(o)return o(i,!0);var u=new Error("Cannot find module '"+i+"'");throw u.code="MODULE_NOT_FOUND",u}var f=r[i]={exports:{}};e[i][0].call(f.exports,function(t){var r=e[i][1][t];return a(r?r:t)},f,f.exports,t,e,r,n)}return r[i].exports}for(var o="function"==typeof require&&require,i=0;i<n.length;i++)a(n[i]);return a}({1:[function(t,e,r){"use strict";var n;!function(t){t[t.Converged=0]="Converged",t[t.MaxStepsExceeded=1]="MaxStepsExceeded",t[t.EarlyReturn=2]="EarlyReturn"}(n=r.Outcome||(r.Outcome={}));var a=function(){function t(t){this.n=t,this.uRound=2.3e-16,this.maxSteps=1e4,this.initialStepSize=1e-4,this.maxStepSize=0,this.maxExtrapolationColumns=9,this.stepSizeSequence=0,this.stabilityCheckCount=1,this.stabilityCheckTableLines=2,this.denseOutput=!1,this.denseOutputErrorEstimator=!0,this.denseComponents=void 0,this.interpolationFormulaDegree=4,this.stepSizeReductionFactor=.5,this.stepSizeFac1=.02,this.stepSizeFac2=4,this.stepSizeFac3=.8,this.stepSizeFac4=.9,this.stepSafetyFactor1=.65,this.stepSafetyFactor2=.94,this.relativeTolerance=1e-5,this.absoluteTolerance=1e-5,this.debug=!1}return t.prototype.grid=function(t,e){var r=this.denseComponents;if(!r){r=[];for(var n=0;n<this.n;++n)r.push(n)}var a;return function(n,o,i,s,c){if(1===n)return e(i,s),void(a=i+t);for(;a<=i;){for(var u=[],f=0,h=r;f<h.length;f++){var p=h[f];u.push(c(p,a))}e(a,u),a+=t}}},t.dim2=function(e,r){for(var n=new Array(e+1),a=1;a<=e;++a)n[a]=t.dim(r);return n},t.stepSizeSequence=function(t,e){var r=new Array(e+1);switch(r[0]=0,t){case 1:for(var n=1;n<=e;++n)r[n]=2*n;break;case 2:r[1]=2;for(var n=2;n<=e;++n)r[n]=4*n-4;break;case 3:r[1]=2,r[2]=4,r[3]=6;for(var n=4;n<=e;++n)r[n]=2*r[n-2];break;case 4:for(var n=1;n<=e;++n)r[n]=4*n-2;break;case 5:for(var n=1;n<=e;++n)r[n]=4*n;break;default:throw new Error("invalid stepSizeSequence selected")}return r},t.prototype.solve=function(e,r,a,o,i){function s(t,e){var r=[0];if(Array.isArray(t))return r.concat(t);for(var n=0;n<e;++n)r.push(t);return r}var c=this,u=[0].concat(a),f=t.dim(this.n),h=t.dim(this.n),p=t.dim(this.n);if(this.maxSteps<=0)throw new Error("maxSteps must be positive");var v=this.maxExtrapolationColumns;if(v<=2)throw new Error("maxExtrapolationColumns must be > 2");var l=this.stepSizeSequence||(this.denseOutput?4:1);if(l<=3&&this.denseOutput)throw new Error("stepSizeSequence incompatible with denseOutput");if(this.denseOutput&&!i)throw new Error("denseOutput requires a solution observer function");if(this.interpolationFormulaDegree<=0||this.interpolationFormulaDegree>=7)throw new Error("bad interpolationFormulaDegree");var d=[0],m=0;if(this.denseOutput)if(this.denseComponents)for(var M=0,S=this.denseComponents;M<S.length;M++){var w=S[M];if(w<0||w>this.n)throw new Error("bad dense component: "+w);d.push(w+1),++m}else{for(var x=1;x<=this.n;++x)d.push(x);m=this.n}if(this.uRound<=1e-35||this.uRound>1)throw new Error("suspicious value of uRound");var g=Math.abs(this.maxStepSize||o-r),b=2*v*v+v,y=s(this.absoluteTolerance,this.n),E=s(this.relativeTolerance,this.n),F=[0,0,0,0],C=F[0],z=F[1],O=F[2],R=F[3],A=Math.max(1,m),q=Math.max(1,(2*v+5)*m),P=t.dim(q),k=t.dim2(b,A),I=function(t,r,n){for(var a=e(t,r.slice(1)),o=0;o<a.length;++o)n[o+1]=a[o]},T=function(){var e,a,s,m=function(t){if(N=r,r+=L,c.denseOutput){s=2*at-c.interpolationFormulaDegree+1;for(var n=1;n<=A;++n)P[n]=u[d[n]];e=N,a=L;for(var n=1;n<=A;++n)P[A+n]=L*f[d[n]];for(var o=2*A,n=1;n<=A;++n)P[o+n]=F[1][d[n]];for(var m=2;m<=at;++m)for(var M=q[m],g=m;g>=2;--g)for(var y=Math.pow(M/q[g-1],2)-1,n=1;n<=A;++n)x[g-1][n]=x[g][n]+(x[g][n]-x[g-1][n])/y;for(var E=4*A,n=1;n<=A;++n)P[E+n]=x[1][n];for(var n=1;n<=t;++n)h[n]=F[1][n];I(r,h,p),E=3*A;for(var n=1;n<=A;++n)P[E+n]=p[d[n]]*L;for(var C=1;C<=s;++C){for(var z=(C+1)/2|0,j=z;j<=at;++j){var U=Math.pow(q[j]/2,C-1);K=V[j+1]-2*j+C;for(var n=1;n<=A;++n)x[j][n]=k[K][n]*U}for(var m=z+1;m<=at;++m)for(var M=q[m],g=m;g>=z+1;--g)for(var y=Math.pow(M/q[g-1],2)-1,n=1;n<=A;++n)x[g-1][n]=x[g][n]+(x[g][n]-x[g-1][n])/y;E=(C+4)*A;for(var n=1;n<=A;++n)P[E+n]=x[z][n]*L;if(C!==s){for(var j=(C+2)/2|0;j<=at;++j){var X=V[j+1],Y=V[j]+C+1;1===C&&4===l&&(Y+=2);var g=void 0;for(g=X;g>=Y;g-=2)for(var n=1;n<=A;++n)k[g][n]-=k[g-2][n];if(1===C&&4===l){g=Y-2;for(var n=1;n<=A;++n)k[g][n]-=f[d[n]]}}for(var j=(C+2)/2|0;j<=at;++j)for(var X=V[j+1]-1,Y=V[j]+C+2,g=X;g>=Y;g-=2)for(var n=1;n<=A;++n)k[g][n]-=k[g-2][n]}}if(S(A,P,s),c.denseOutputErrorEstimator&&s>=1){for(var G=0,n=1;n<=A;++n)G+=Math.pow(P[(s+4)*A+n]/D[d[n]],2);if(G=Math.sqrt(G/A)*_[s],Z=L/Math.max(Math.pow(G,1/(s+4)),.01),G>10)return L=Z,r=N,++R,rt=!0,!0}for(var n=1;n<=t;++n)f[n]=p[n]}for(var n=1;n<=t;++n)u[n]=F[1][n];if(++O,i&&i(O+1,N,r,u.slice(1),c.denseOutput&&w(e,a,s,P,d))===!1)return!1;var J;return 2===at?(J=Math.min(3,v-1),rt&&(J=2)):at<=B?(J=at,$[at-1]<$[at]*c.stepSizeFac3&&(J=at-1),$[at]<$[at-1]*c.stepSizeFac4&&(J=Math.min(at+1,v-1))):(J=at-1,at>3&&$[at-2]<$[at-1]*c.stepSizeFac3&&(J=at-2),$[at]<$[J]*c.stepSizeFac4&&(J=Math.min(at,v-1))),rt?(B=Math.min(J,at),L=H*Math.min(Math.abs(L),Math.abs(b[B])),rt=!1,!0):(L=J<=at?b[J]:at<B&&$[at]<$[at-1]*c.stepSizeFac4?b[at]*T[J+1]/T[at]:b[at]*T[J]/T[at],B=J,L=H*Math.abs(L),!0)},M=function(e){for(var n=t.dim(c.n),a=L/q[e],o=1;o<=c.n;++o)h[o]=u[o],p[o]=u[o]+a*f[o];for(var i=q[e]-1,s=q[e]/2|0,v=1;v<=i;++v){if(c.denseOutput&&v===s)for(var o=1;o<=A;++o)x[e][o]=p[d[o]];if(I(r+a*v,p,n),c.denseOutput&&Math.abs(v-s)<=2*e-1){++K;for(var o=1;o<=A;++o)k[K][o]=n[d[o]]}for(var o=1;o<=c.n;++o){var l=h[o];h[o]=p[o],p[o]=l+2*a*n[o]}if(v<=c.stabilityCheckCount&&e<=c.stabilityCheckTableLines){for(var m=0,o=1;o<=c.n;++o)m+=Math.pow(f[o]/D[o],2);for(var M=0,o=1;o<=c.n;++o)M+=Math.pow((n[o]-f[o])/D[o],2);var S=M/Math.max(c.uRound,m);if(S>4)return++C,tt=!0,L*=c.stepSizeReductionFactor,void(rt=!0)}}if(I(r+L,p,n),c.denseOutput&&s<=2*e-1){++K;for(var o=1;o<=A;++o)k[K][o]=n[d[o]]}for(var o=1;o<=c.n;++o)F[e][o]=(h[o]+p[o]+a*n[o])/2;if(C+=q[e],1!==e){for(var w,z=q[e],O=e;O>1;--O){w=Math.pow(z/q[O-1],2)-1;for(var o=1;o<=c.n;++o)F[O-1][o]=F[O][o]+(F[O][o]-F[O-1][o])/w}Q=0;for(var o=1;o<=c.n;++o){var R=Math.max(Math.abs(u[o]),Math.abs(F[1][o]));D[o]=y[o]+E[o]*R,Q+=Math.pow((F[1][o]-F[2][o])/D[o],2)}if(Q=Math.sqrt(Q/c.n),Q*c.uRound>=1||e>2&&Q>=W)return tt=!0,L*=c.stepSizeReductionFactor,void(rt=!0);W=Math.max(4*Q,1);var P=1/(2*e-1),j=Math.pow(c.stepSizeFac1,P);w=Math.min(c.stepSizeFac2/j,Math.max(j,Math.pow(Q/c.stepSafetyFactor1,P)/c.stepSafetyFactor2)),w=1/w,b[e]=Math.min(Math.abs(L)*w,g),$[e]=T[e]/b[e]}},S=function(t,e,r){for(var n=new Array(31),a=1;a<=t;++a){var o=e[a],i=e[2*t+a],s=e[t+a],c=e[3*t+a],u=i-o,f=-c+u,h=s-u;if(e[t+a]=u,e[2*t+a]=f,e[3*t+a]=h,!(r<0)){var p=.5*(o+i)+.125*(f+h),v=u+.25*(f-h),l=-(s-c),d=6*(h-f);if(r>=1&&(n[1]=16*(e[5*t+a]-v),r>=3&&(n[3]=16*(e[7*t+a]-d+3*n[1]),r>=5)))for(var m=5;m<=r;m+=2){var M=m*(m-1)/2,S=M*(m-2)*(m-3)*2;n[m]=16*(e[(m+4)*t+a]+M*n[m-2]-S*n[m-4])}if(n[0]=16*(e[4*t+a]-p),r>=2&&(n[2]=16*(e[6*t+a]-l+n[0]),r>=4))for(var m=4;m<=r;m+=2){var M=m*(m-1)/2,S=m*(m-1)*(m-2)*(m-3);n[m]=16*(e[t*(m+4)+a]+n[m-2]*M-n[m-4]*S)}for(var m=0;m<=r;++m)e[t*(m+4)+a]=n[m]}}},w=function(t,e,r,n,a){return function(o,i){for(var s=0,c=1;c<=A;++c)a[c]===o+1&&(s=c);if(0===s)throw new Error("no dense output available for component "+o);var u=(i-t)/e,f=1-u,h=n[s]+u*(n[A+s]+f*(n[2*A+s]*u+n[3*A+s]*f));if(r<0)return h;for(var p=u-.5,v=n[A*(r+4)+s],l=r;l>=1;--l)v=n[A*(l+3)+s]+v*p/l;return h+Math.pow(u*f,2)*v}},x=t.dim2(v,A),b=t.dim(v),F=t.dim2(v,c.n),q=t.stepSizeSequence(l,v),T=t.dim(v);T[1]=1+q[1];for(var j=2;j<=v;++j)T[j]=T[j-1]+q[j];for(var D=t.dim(c.n),j=1;j<=c.n;++j)D[j]=y[j]+E[j]+Math.abs(u[j]);var H=o-r>=0?1:-1,B=Math.max(2,Math.min(v-1,Math.floor(.6*-t.log10(E[1]+1e-40)+1.5))),L=Math.max(Math.abs(c.initialStepSize),1e-4);L=H*Math.min(L,g,Math.abs(o-r)/2);var V=t.dim(v+1),_=t.dim(2*v),N=r,K=0;if(i){if(c.denseOutput){V[1]=0;for(var j=1;j<=v;++j){var U=4*j-2;q[j]>U&&++U,V[j+1]=V[j]+U}for(var X=1;X<=2*v;++X){for(var Y=.5*Math.sqrt(X/(X+4)),G=Math.pow(1/(X+4),2),J=1;J<=X;++J)G*=Y/J;_[X]=G}K=0}if(!1===i(O+1,N,r,u.slice(1)))return n.EarlyReturn}var Q=0,W=1e10,Z=H*g,$=t.dim(v);$[1]=0;var tt,et,rt=!1,nt=!1,at=0;!function(t){t[t.Start=0]="Start",t[t.BasicIntegrationStep=1]="BasicIntegrationStep",t[t.ConvergenceStep=2]="ConvergenceStep",t[t.HopeForConvergence=3]="HopeForConvergence",t[t.Accept=4]="Accept",t[t.Reject=5]="Reject"}(et||(et={}));var ot=et.Start;t:for(;;)switch(c.debug&&console.log("STATE",et[ot],z,N,r,L,B,at,Z),ot){case et.Start:if(tt=!1,.1*Math.abs(o-r)<=Math.abs(r)*c.uRound)break t;if(L=H*Math.min(Math.abs(L),Math.abs(o-r),g,Math.abs(Z)),(r+1.01*L-o)*H>0&&(L=o-r,nt=!0),0!==z&&c.denseOutput||(I(r,u,f),++C),0===z||nt){K=0,++z;for(var J=1;J<=B;++J){if(at=J,M(J),tt)continue t;if(J>1&&Q<=1){ot=et.Accept;continue t}}ot=et.HopeForConvergence;continue}ot=et.BasicIntegrationStep;continue;case et.BasicIntegrationStep:if(K=0,++z,z>=c.maxSteps)return n.MaxStepsExceeded;at=B-1;for(var J=1;J<=at;++J)if(M(J),tt){ot=et.Start;continue t}ot=2===B||rt?et.ConvergenceStep:Q<=1?et.Accept:Q>Math.pow(q[B+1]*q[B]/4,2)?et.Reject:et.ConvergenceStep;continue;case et.ConvergenceStep:if(M(B),tt){ot=et.Start;continue}if(at=B,Q<=1){ot=et.Accept;continue}ot=et.HopeForConvergence;continue;case et.HopeForConvergence:if(Q>Math.pow(q[B+1]/2,2)){ot=et.Reject;continue}at=B+1,M(at),ot=tt?et.Start:Q>1?et.Reject:et.Accept;continue;case et.Accept:if(!m(c.n))return n.EarlyReturn;ot=et.Start;continue;case et.Reject:B=Math.min(B,at,v-1),B>2&&$[B-1]<$[B]*c.stepSizeFac3&&(B-=1),++R,L=H*b[B],rt=!0,ot=et.BasicIntegrationStep}return n.Converged},j=T();return{y:u.slice(1),outcome:j,nStep:z,xEnd:o,nAccept:O,nReject:R,nEval:C}},t}();a.dim=function(t){return Array(t+1)},a.log10=function(t){return Math.log(t)/Math.LN10},r.Solver=a},{}],2:[function(t,e,r){"use strict";var n=t("odex/src/odex"),a=2*Math.PI,o=function(){function t(e){this.K=e,this.PV=t.principal_value(a)}return t.principal_value=function(t){var e=t-a;return function(r){if(e<=r&&r<t)return r;var n=r-a*Math.floor(r/a);return n<t?n:n-a}},t.prototype.generateSection=function(t,e,r){for(var n=t[0],a=t[1],o=0;o<e;++o){r(n,a);var i=a+this.K*Math.sin(n);n=this.PV(n+i),a=this.PV(i)}},t}();o.twoPi=2*Math.PI,r.StandardMap=o;var i=function(){function t(t){this.paramfn=t,this.S=new n.Solver(3),this.S.denseOutput=!0,this.S.absoluteTolerance=1e-8,this.PV=o.principal_value(Math.PI)}return t.prototype.HamiltonSysder=function(t,e,r,n,a){return function(o,i){var s=i[0],c=i[1],u=i[2],f=(Math.sin(r*s),Math.pow(e,2)),h=r*s,p=Math.sin(c),v=Math.cos(c);return[1,(Math.sin(h)*p*n*e*t*r+u)/(f*t),(-Math.pow(Math.sin(h),2)*v*p*Math.pow(n,2)*e*t*Math.pow(r,2)-Math.sin(h)*v*n*r*u-p*a*f*t)/e]}},t.prototype.LagrangeSysder=function(t,e,r,n,a){return function(t,o){var i=o[0],s=o[1],c=o[2],u=Math.sin(s);return[1,c,(u*Math.cos(r*i)*n*Math.pow(r,2)-u*a)/e]}},t.prototype.generateSection=function(t,e,r){var n=this,a=this.paramfn();console.log("params",a);var o=2*Math.PI/a.omega,i=1e3*o,s=this.HamiltonSysder(1,1,a.omega,a.a,9.8);this.S.solve(s,0,[0].concat(t),i,this.S.grid(o,function(t,e){return r(n.PV(e[1]),e[2])}))},t.prototype.evolve=function(t,e,r,n){var a=this.paramfn();console.log("params",a);var o=this.LagrangeSysder(1,1,a.omega,a.a,9.8),i=performance.now();this.S.solve(o,0,[0].concat(t),e,this.S.grid(r,n)),console.log("evolution took",(performance.now()-i).toFixed(2),"msec")},t}();r.DrivenPendulumMap=i;var s=function(){function t(t,e,r,n){var a=this;this.i=0,this.pt=function(t,e){a.context.beginPath(),a.context.arc(t,e,.01,0,2*Math.PI),a.context.fill(),a.context.closePath(),++a.i},this.canvas=document.getElementById(t),this.M=e,this.context=this.canvas.getContext("2d");var o=[r[1]-r[0],n[1]-n[0]],i=o[0],s=o[1];this.canvas.onmousedown=function(t){var e=[t.offsetX/a.context.canvas.width*i+r[0],n[1]-t.offsetY/a.context.canvas.height*s],o=e[0],c=e[1],u=performance.now();a.Explore(o,c),console.log("exploration",(performance.now()-u).toFixed(2),"msec"),a.onExplore&&a.onExplore(o,c)},this.context.scale(this.context.canvas.width/i,-this.context.canvas.height/s),this.context.translate(-r[0],-n[1]),this.context.fillStyle="rgba(23,64,170,0.5)"}return t.prototype.Explore=function(t,e){this.M.generateSection([t,e],1e3,this.pt)},t}();r.ExploreMap=s},{"odex/src/odex":1}]},{},[2])(2)});